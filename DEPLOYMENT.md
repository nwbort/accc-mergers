# Deployment Configuration

This document describes the deployment setup for the ACCC Merger Tracker using Cloudflare Pages only (no backend server required).

## Overview

The architecture is fully static:

- **GitHub Actions** scrapes ACCC website and generates all data files
- **Cloudflare Pages** serves the React frontend and static JSON data
- No backend server required

```
GitHub Actions (hourly scrape, daily extract)
    ↓
Scrapes ACCC → matters/*.html
    ↓
Extracts → mergers.json
    ↓
Generates static data files:
  - merger-tracker/frontend/public/data/mergers.json
  - merger-tracker/frontend/public/data/stats.json
  - merger-tracker/frontend/public/data/timeline.json
  - merger-tracker/frontend/public/data/industries.json
  - merger-tracker/frontend/public/data/upcoming-events.json
    ↓
Commits to main branch
    ↓
Cloudflare Pages auto-deploys
```

## Cloudflare Pages Configuration

### Build settings

- **Framework preset**: None (or Vite)
- **Build command**: `cd merger-tracker/frontend && npm install && npm run build && cp -r ../../matters dist/matters`
- **Build output directory**: `merger-tracker/frontend/dist`
- **Root directory**: `/` (repository root)

### Environment variables

No environment variables required for the static deployment.

For local development, you can optionally set:
- `VITE_API_URL` - not used in production (static files are served from `/data/`)

### Custom domain

Configure your custom domain (e.g., `mergers.fyi`) in Cloudflare Pages settings.

## GitHub Configuration

### Workflows

#### `.github/workflows/scrape.yml`

Runs hourly to scrape the ACCC website for new merger pages.

#### `.github/workflows/extract.yml`

Runs daily (and on changes to `matters/`) to:
1. Extract merger data from HTML files → `mergers.json`
2. Generate static data files → `merger-tracker/frontend/public/data/*.json`
3. Commit changes to trigger Cloudflare Pages deployment

## Static Data Files

All data files are pre-generated by `generate_static_data.py`:

| File | Description |
|------|-------------|
| `mergers.json` | All mergers with full details |
| `stats.json` | Aggregated statistics (counts, averages, medians) |
| `timeline.json` | All events sorted by date |
| `industries.json` | ANZSIC codes with merger counts |
| `upcoming-events.json` | Future consultation/determination dates |

### Regenerating data locally

```bash
python generate_static_data.py
```

This reads `mergers.json` and outputs to `merger-tracker/frontend/public/data/`.

## Local Development

### Frontend only

```bash
cd merger-tracker/frontend
npm install
npm run dev
```

The dev server will serve static JSON from `public/data/`.

### Full pipeline

```bash
# 1. Scrape (optional - use existing matters/ data)
./scrape.sh

# 2. Extract merger data
python extract_mergers.py

# 3. Generate static files
python generate_static_data.py

# 4. Run frontend
cd merger-tracker/frontend
npm run dev
```

## Business Day Calculations

Business day calculations (for "days remaining" displays) happen client-side using:
- `merger-tracker/frontend/src/utils/dates.js`
- `merger-tracker/frontend/src/data/act-public-holidays.json`

The static data includes raw dates; the frontend calculates business days at render time.

## Benefits of Static Architecture

- **$0/month** hosting cost (Cloudflare Pages free tier)
- **Global CDN** - fast everywhere
- **No server maintenance** - no backend to monitor/update
- **Version controlled data** - full history in git
- **Simple deployment** - just push to main branch
- **Offline capable** - could add service worker for PWA

## Limitations

- **No real-time updates** - data refreshes on GitHub Actions schedule
- **No user-generated content** - commentary feature removed
- **No server-side auth** - all data is public

## Monitoring

1. **GitHub Actions**: Check workflow runs for scrape/extract success
2. **Cloudflare Pages**: Check deployment status in dashboard
3. **Data freshness**: Compare `mergers.json` timestamps

## Troubleshooting

### Data not updating

1. Check GitHub Actions workflow completed successfully
2. Verify `mergers.json` was updated (check git history)
3. Verify static data files were regenerated
4. Check Cloudflare Pages deployment succeeded

### Build failures

1. Check Node.js version matches `.node-version`
2. Verify `npm install` succeeds locally
3. Check for TypeScript/ESLint errors in build output

### Missing data

1. Verify `generate_static_data.py` ran successfully
2. Check `merger-tracker/frontend/public/data/` contains all JSON files
3. Ensure files are committed to the repository
